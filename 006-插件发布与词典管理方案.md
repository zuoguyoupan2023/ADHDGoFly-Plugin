# æ’ä»¶å‘å¸ƒä¸è¯å…¸ç®¡ç†æ–¹æ¡ˆ

## 1. Chromeæ’ä»¶å‘å¸ƒä¸æ›´æ–°æœºåˆ¶

### 1.1 Chromeå®˜æ–¹æ¸ é“å‘å¸ƒ

#### å‘å¸ƒæµç¨‹
1. **å¼€å‘è€…è´¦å·æ³¨å†Œ**
   - æ³¨å†ŒChrome Web Storeå¼€å‘è€…è´¦å·
   - æ”¯ä»˜ä¸€æ¬¡æ€§æ³¨å†Œè´¹ç”¨ï¼ˆ$5ï¼‰
   - å®Œæˆèº«ä»½éªŒè¯

2. **æ’ä»¶æäº¤**
   - å‡†å¤‡æ’ä»¶åŒ…ï¼ˆzipæ ¼å¼ï¼‰
   - å¡«å†™æ’ä»¶è¯¦ç»†ä¿¡æ¯ï¼ˆåç§°ã€æè¿°ã€æˆªå›¾ç­‰ï¼‰
   - è®¾ç½®æƒé™è¯´æ˜
   - æäº¤å®¡æ ¸ï¼ˆé€šå¸¸1-3ä¸ªå·¥ä½œæ—¥ï¼‰

3. **å®¡æ ¸é€šè¿‡åå‘å¸ƒ**
   - æ’ä»¶åœ¨Chrome Web Storeä¸Šçº¿
   - ç”¨æˆ·å¯ä»¥æœç´¢å¹¶å®‰è£…

#### å®˜æ–¹æ¸ é“æ›´æ–°æœºåˆ¶
- **è‡ªåŠ¨æ›´æ–°**ï¼šChromeæµè§ˆå™¨ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶æ›´æ–°å·²å®‰è£…çš„æ’ä»¶
- **æ›´æ–°é¢‘ç‡**ï¼šé€šå¸¸åœ¨æ’ä»¶å‘å¸ƒæ–°ç‰ˆæœ¬å24-48å°æ—¶å†…æ¨é€ç»™ç”¨æˆ·
- **ç”¨æˆ·é€šçŸ¥**ï¼š
  - Chromeä¼šåœ¨åå°é™é»˜æ›´æ–°
  - é‡è¦æ›´æ–°å¯é€šè¿‡æ’ä»¶å›¾æ ‡æ˜¾ç¤ºæ›´æ–°æç¤º
  - å¯åœ¨æ’ä»¶å¼¹çª—ä¸­æ˜¾ç¤ºæ›´æ–°æ—¥å¿—

#### ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
```json
{
  "manifest_version": 3,
  "version": "1.2.3",
  "version_name": "1.2.3 - æ–°å¢è¯å…¸ç®¡ç†åŠŸèƒ½"
}
```

### 1.2 è‡ªä¸»åˆ†å‘æ›´æ–°æœºåˆ¶

#### åˆ†å‘æ–¹å¼
1. **GitHub Releases**
   - åœ¨GitHubä»“åº“å‘å¸ƒç‰ˆæœ¬
   - æä¾›crxæ–‡ä»¶ä¸‹è½½
   - ç”¨æˆ·æ‰‹åŠ¨å®‰è£…

2. **å®˜æ–¹ç½‘ç«™åˆ†å‘**
   - å»ºç«‹å®˜æ–¹ä¸‹è½½é¡µé¢
   - æä¾›å®‰è£…æ•™ç¨‹
   - ç»´æŠ¤ç‰ˆæœ¬å†å²

#### æ›´æ–°é€šçŸ¥æœºåˆ¶

**æ–¹æ¡ˆä¸€ï¼šå†…ç½®æ›´æ–°æ£€æŸ¥**
```javascript
// background.js ä¸­å®ç°
class UpdateChecker {
  constructor() {
    this.updateUrl = 'https://api.github.com/repos/username/repo/releases/latest';
    this.checkInterval = 24 * 60 * 60 * 1000; // 24å°æ—¶æ£€æŸ¥ä¸€æ¬¡
  }

  async checkForUpdates() {
    try {
      const response = await fetch(this.updateUrl);
      const latestRelease = await response.json();
      const latestVersion = latestRelease.tag_name;
      const currentVersion = chrome.runtime.getManifest().version;
      
      if (this.isNewerVersion(latestVersion, currentVersion)) {
        this.notifyUpdate(latestRelease);
      }
    } catch (error) {
      console.error('æ£€æŸ¥æ›´æ–°å¤±è´¥:', error);
    }
  }

  notifyUpdate(release) {
    // æ˜¾ç¤ºæ›´æ–°é€šçŸ¥
    chrome.notifications.create({
      type: 'basic',
      iconUrl: 'icon.png',
      title: 'ADHDé˜…è¯»åŠ©æ‰‹æœ‰æ–°ç‰ˆæœ¬',
      message: `å‘ç°æ–°ç‰ˆæœ¬ ${release.tag_name}ï¼Œç‚¹å‡»æŸ¥çœ‹æ›´æ–°å†…å®¹`
    });
    
    // åœ¨æ’ä»¶å¼¹çª—ä¸­æ˜¾ç¤ºæ›´æ–°æç¤º
    chrome.storage.local.set({
      updateAvailable: {
        version: release.tag_name,
        downloadUrl: release.assets[0].browser_download_url,
        releaseNotes: release.body
      }
    });
  }
}
```

**æ–¹æ¡ˆäºŒï¼šé‚®ä»¶è®¢é˜…é€šçŸ¥**
- å»ºç«‹é‚®ä»¶è®¢é˜…ç³»ç»Ÿ
- ç”¨æˆ·å¯é€‰æ‹©è®¢é˜…æ›´æ–°é€šçŸ¥
- å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶å‘é€é‚®ä»¶é€šçŸ¥

**æ–¹æ¡ˆä¸‰ï¼šç¤¾äº¤åª’ä½“é€šçŸ¥**
- é€šè¿‡å¾®åšã€Twitterç­‰å¹³å°å‘å¸ƒæ›´æ–°ä¿¡æ¯
- å»ºç«‹ç”¨æˆ·ç¾¤ç»„ï¼ˆQQç¾¤ã€å¾®ä¿¡ç¾¤ï¼‰
- å®šæœŸå‘å¸ƒæ›´æ–°å…¬å‘Š

## 2. è¯å…¸ç®¡ç†ä¸æ›´æ–°æ–¹æ¡ˆ

### 2.1 è¯å…¸æ¶æ„è®¾è®¡

#### å½“å‰è¯å…¸ç»“æ„
```
dictionaries/
â”œâ”€â”€ ZH_word.json    # ä¸­æ–‡è¯å…¸
â”œâ”€â”€ EN_word.json    # è‹±æ–‡è¯å…¸
â”œâ”€â”€ JA_word.json    # æ—¥æ–‡è¯å…¸
â”œâ”€â”€ FR_word.json    # æ³•æ–‡è¯å…¸
â”œâ”€â”€ ES_word.json    # è¥¿ç­ç‰™æ–‡è¯å…¸
â””â”€â”€ RU_word.json    # ä¿„æ–‡è¯å…¸
```

#### è¯å…¸ç‰ˆæœ¬ç®¡ç†
```json
{
  "version": "1.0.0",
  "lastUpdated": "2024-01-15T10:30:00Z",
  "totalWords": 50000,
  "categories": {
    "noun": 25000,
    "verb": 15000,
    "adjective": 10000
  },
  "words": {
    "apple": {
      "pos": "n",
      "frequency": 0.8,
      "difficulty": 1
    }
  }
}
```

### 2.2 è¯å…¸æ›´æ–°æœºåˆ¶

#### æ–¹æ¡ˆä¸€ï¼šå¢é‡æ›´æ–°ç³»ç»Ÿ

**1. è¯å…¸ç‰ˆæœ¬æœåŠ¡å™¨**
```javascript
// è¯å…¸ç‰ˆæœ¬æ£€æŸ¥API
const DICTIONARY_API = 'https://api.adhdhelper.com/dictionaries';

class DictionaryManager {
  async checkDictionaryUpdates() {
    const localVersions = await this.getLocalDictionaryVersions();
    const response = await fetch(`${DICTIONARY_API}/versions`);
    const serverVersions = await response.json();
    
    const updatesNeeded = [];
    
    for (const [lang, serverVersion] of Object.entries(serverVersions)) {
      const localVersion = localVersions[lang] || '0.0.0';
      if (this.isNewerVersion(serverVersion.version, localVersion)) {
        updatesNeeded.push({
          language: lang,
          currentVersion: localVersion,
          newVersion: serverVersion.version,
          updateSize: serverVersion.size,
          updateType: serverVersion.updateType // 'full' | 'incremental'
        });
      }
    }
    
    return updatesNeeded;
  }

  async downloadDictionaryUpdate(language, updateType) {
    const url = `${DICTIONARY_API}/${language}/${updateType}`;
    const response = await fetch(url);
    const updateData = await response.json();
    
    if (updateType === 'incremental') {
      await this.applyIncrementalUpdate(language, updateData);
    } else {
      await this.replaceFullDictionary(language, updateData);
    }
  }
}
```

**2. å¢é‡æ›´æ–°æ ¼å¼**
```json
{
  "version": "1.1.0",
  "previousVersion": "1.0.0",
  "updateType": "incremental",
  "changes": {
    "added": {
      "smartphone": {
        "pos": "n",
        "frequency": 0.9,
        "difficulty": 2
      }
    },
    "modified": {
      "computer": {
        "frequency": 0.95
      }
    },
    "removed": ["obsoleteword1", "obsoleteword2"]
  }
}
```

#### æ–¹æ¡ˆäºŒï¼šäº‘ç«¯è¯å…¸æœåŠ¡

**1. å®æ—¶è¯å…¸API**
```javascript
class CloudDictionaryService {
  constructor() {
    this.apiBase = 'https://api.adhdhelper.com';
    this.cache = new Map();
    this.cacheExpiry = 24 * 60 * 60 * 1000; // 24å°æ—¶ç¼“å­˜
  }

  async getWordInfo(word, language = 'auto') {
    const cacheKey = `${word}_${language}`;
    const cached = this.cache.get(cacheKey);
    
    if (cached && Date.now() - cached.timestamp < this.cacheExpiry) {
      return cached.data;
    }

    try {
      const response = await fetch(`${this.apiBase}/word/${word}?lang=${language}`);
      const wordInfo = await response.json();
      
      this.cache.set(cacheKey, {
        data: wordInfo,
        timestamp: Date.now()
      });
      
      return wordInfo;
    } catch (error) {
      // é™çº§åˆ°æœ¬åœ°è¯å…¸
      return this.getLocalWordInfo(word, language);
    }
  }
}
```

### 2.3 ç”¨æˆ·é€šçŸ¥æœºåˆ¶

#### è¯å…¸æ›´æ–°é€šçŸ¥UI

**1. å¼¹çª—é€šçŸ¥ç»„ä»¶**
```html
<!-- è¯å…¸æ›´æ–°é€šçŸ¥å¼¹çª— -->
<div id="dictionary-update-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ğŸ“š è¯å…¸æ›´æ–°å¯ç”¨</h3>
      <button class="close-btn">&times;</button>
    </div>
    <div class="modal-body">
      <div class="update-info">
        <p>å‘ç° <strong id="update-count">3</strong> ä¸ªè¯å…¸æœ‰æ›´æ–°ï¼š</p>
        <ul id="update-list">
          <li>
            <span class="lang-flag">ğŸ‡¨ğŸ‡³</span>
            ä¸­æ–‡è¯å…¸ v1.2.0 â†’ v1.3.0
            <span class="update-size">(+2,500è¯)</span>
          </li>
        </ul>
      </div>
      <div class="update-benefits">
        <h4>æ›´æ–°å†…å®¹ï¼š</h4>
        <ul>
          <li>æ–°å¢ç§‘æŠ€ç±»è¯æ±‡2,500ä¸ª</li>
          <li>ä¼˜åŒ–è¯é¢‘æ•°æ®å‡†ç¡®æ€§</li>
          <li>ä¿®å¤éƒ¨åˆ†è¯æ€§æ ‡æ³¨é”™è¯¯</li>
        </ul>
      </div>
    </div>
    <div class="modal-footer">
      <button id="update-now-btn" class="btn-primary">ç«‹å³æ›´æ–°</button>
      <button id="update-later-btn" class="btn-secondary">ç¨åæé†’</button>
      <button id="skip-update-btn" class="btn-text">è·³è¿‡æ­¤ç‰ˆæœ¬</button>
    </div>
  </div>
</div>
```

**2. æ›´æ–°è¿›åº¦æ˜¾ç¤º**
```javascript
class DictionaryUpdateUI {
  showUpdateProgress(updates) {
    const progressModal = document.getElementById('update-progress-modal');
    const progressBar = document.getElementById('update-progress-bar');
    const statusText = document.getElementById('update-status-text');
    
    progressModal.style.display = 'block';
    
    let completed = 0;
    const total = updates.length;
    
    updates.forEach(async (update, index) => {
      statusText.textContent = `æ­£åœ¨æ›´æ–°${update.language}è¯å…¸...`;
      
      await this.downloadDictionaryUpdate(update.language);
      
      completed++;
      const progress = (completed / total) * 100;
      progressBar.style.width = `${progress}%`;
      
      if (completed === total) {
        statusText.textContent = 'æ›´æ–°å®Œæˆï¼';
        setTimeout(() => {
          progressModal.style.display = 'none';
          this.showUpdateSuccess();
        }, 1000);
      }
    });
  }

  showUpdateSuccess() {
    // æ˜¾ç¤ºæ›´æ–°æˆåŠŸé€šçŸ¥
    chrome.notifications.create({
      type: 'basic',
      iconUrl: 'icon.png',
      title: 'è¯å…¸æ›´æ–°å®Œæˆ',
      message: 'æ‰€æœ‰è¯å…¸å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œäº«å—æ›´å‡†ç¡®çš„è¯æ±‡è¯†åˆ«ï¼'
    });
  }
}
```

#### é€šçŸ¥ç­–ç•¥

**1. è‡ªåŠ¨æ£€æŸ¥æ—¶æœº**
- æ’ä»¶å¯åŠ¨æ—¶æ£€æŸ¥
- æ¯å‘¨å®šæ—¶æ£€æŸ¥
- ç”¨æˆ·æ‰‹åŠ¨è§¦å‘æ£€æŸ¥

**2. é€šçŸ¥é¢‘ç‡æ§åˆ¶**
```javascript
class NotificationManager {
  constructor() {
    this.notificationCooldown = 7 * 24 * 60 * 60 * 1000; // 7å¤©å†·å´æœŸ
  }

  async shouldShowUpdateNotification(updateInfo) {
    const lastNotification = await chrome.storage.local.get('lastUpdateNotification');
    const now = Date.now();
    
    // é‡è¦æ›´æ–°ç«‹å³é€šçŸ¥
    if (updateInfo.priority === 'high') {
      return true;
    }
    
    // æ™®é€šæ›´æ–°éµå¾ªå†·å´æœŸ
    if (!lastNotification.lastUpdateNotification || 
        now - lastNotification.lastUpdateNotification > this.notificationCooldown) {
      await chrome.storage.local.set({ lastUpdateNotification: now });
      return true;
    }
    
    return false;
  }
}
```

### 2.4 è¯å…¸ç®¡ç†ç•Œé¢

#### è¯å…¸çŠ¶æ€é¢æ¿
```html
<div class="dictionary-panel">
  <h3>ğŸ“š è¯å…¸ç®¡ç†</h3>
  
  <div class="dictionary-list">
    <div class="dictionary-item" data-lang="zh">
      <div class="dict-info">
        <span class="lang-flag">ğŸ‡¨ğŸ‡³</span>
        <div class="dict-details">
          <h4>ä¸­æ–‡è¯å…¸</h4>
          <p>ç‰ˆæœ¬ v1.3.0 | 52,000è¯ | æœ€åæ›´æ–°ï¼š2024-01-15</p>
        </div>
      </div>
      <div class="dict-actions">
        <button class="btn-small" onclick="checkDictionaryUpdate('zh')">æ£€æŸ¥æ›´æ–°</button>
        <button class="btn-small" onclick="exportDictionary('zh')">å¯¼å‡º</button>
      </div>
    </div>
  </div>
  
  <div class="dictionary-stats">
    <div class="stat-item">
      <span class="stat-label">æ€»è¯æ±‡é‡</span>
      <span class="stat-value">156,000</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">ä¸Šæ¬¡æ›´æ–°</span>
      <span class="stat-value">3å¤©å‰</span>
    </div>
  </div>
</div>
```

## 3. å®æ–½å»ºè®®

### 3.1 å‘å¸ƒç­–ç•¥
1. **åˆæœŸ**ï¼šChromeå®˜æ–¹æ¸ é“å‘å¸ƒï¼Œå»ºç«‹ç”¨æˆ·åŸºç¡€
2. **æˆé•¿æœŸ**ï¼šåŒæ—¶ç»´æŠ¤å®˜æ–¹æ¸ é“å’Œè‡ªä¸»åˆ†å‘
3. **æˆç†ŸæœŸ**ï¼šæ ¹æ®ç”¨æˆ·åé¦ˆä¼˜åŒ–æ›´æ–°æœºåˆ¶

### 3.2 è¯å…¸æ›´æ–°ç­–ç•¥
1. **æ¸è¿›å¼å®æ–½**ï¼šå…ˆå®ç°åŸºç¡€æ›´æ–°æ£€æŸ¥ï¼Œå†æ·»åŠ å¢é‡æ›´æ–°
2. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**ï¼šç¡®ä¿æ›´æ–°è¿‡ç¨‹ä¸å½±å“æ­£å¸¸ä½¿ç”¨
3. **æ•°æ®å®‰å…¨**ï¼šå®ç°è¯å…¸å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

### 3.3 ç›‘æ§ä¸åé¦ˆ
1. **æ›´æ–°æˆåŠŸç‡ç›‘æ§**
2. **ç”¨æˆ·æ»¡æ„åº¦è°ƒæŸ¥**
3. **é”™è¯¯æ—¥å¿—æ”¶é›†**
4. **æ€§èƒ½å½±å“è¯„ä¼°**

## 4. æŠ€æœ¯å®ç°è¦ç‚¹

### 4.1 ç‰ˆæœ¬æ¯”è¾ƒç®—æ³•
```javascript
function compareVersions(version1, version2) {
  const v1parts = version1.split('.').map(Number);
  const v2parts = version2.split('.').map(Number);
  
  for (let i = 0; i < Math.max(v1parts.length, v2parts.length); i++) {
    const v1part = v1parts[i] || 0;
    const v2part = v2parts[i] || 0;
    
    if (v1part > v2part) return 1;
    if (v1part < v2part) return -1;
  }
  
  return 0;
}
```

### 4.2 é”™è¯¯å¤„ç†æœºåˆ¶
```javascript
class UpdateErrorHandler {
  async handleUpdateError(error, context) {
    console.error('æ›´æ–°å¤±è´¥:', error);
    
    // è®°å½•é”™è¯¯æ—¥å¿—
    await this.logError(error, context);
    
    // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
    this.showErrorNotification(error.type);
    
    // å°è¯•å›æ»šæˆ–é™çº§å¤„ç†
    if (context.type === 'dictionary') {
      await this.rollbackDictionary(context.language);
    }
  }
}
```

### 4.3 æ€§èƒ½ä¼˜åŒ–
1. **æ‡’åŠ è½½**ï¼šæŒ‰éœ€åŠ è½½è¯å…¸æ•°æ®
2. **å‹ç¼©ä¼ è¾“**ï¼šä½¿ç”¨gzipå‹ç¼©æ›´æ–°åŒ…
3. **æ–­ç‚¹ç»­ä¼ **ï¼šæ”¯æŒå¤§æ–‡ä»¶åˆ†å—ä¸‹è½½
4. **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´

---

*æœ¬æ–‡æ¡£å°†æ ¹æ®å®é™…å¼€å‘è¿›å±•å’Œç”¨æˆ·åé¦ˆæŒç»­æ›´æ–°å®Œå–„ã€‚*